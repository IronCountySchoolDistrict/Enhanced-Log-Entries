[
    ~[tlist_sql;
        SELECT
            lg.dcid ldcid,
            s.dcid sdcid,
            g.name,
            lg.entry_date,
            substr('00' || to_char(FLOOR(((lg.entry_time-MOD(lg.entry_time, 60))/60)/60)),-2,2) Hours,
            substr('00' || to_char(MOD(((lg.entry_time-(MOD(lg.entry_time, 60)))/60),60)),-2,2) Minutes,
            CASE
                WHEN lg.entry_time < 43200 THEN 'AM'
                ELSE 'PM'
            END ampm,
            lg.entry_author,
            to_char(st.ValueT) subtype,
            lg.subject subject,
            lg.entry logText
        FROM log lg
        INNER JOIN ps.students s ON lg.studentid = s.id
        INNER JOIN ps.gen g ON lg.logtypeid = g.id
        LEFT OUTER JOIN ps.gen st ON st.Name = to_char(g.ID)
            AND st.value = lg.subtype
            AND st.Cat = 'subtype'
        WHERE lg.studentid = ~[gpv:curstudid]
        AND (SELECT to_char(gp.ValueT2) FROM Teachers t INNER JOIN Gen gp ON t.groupValue = gp.ID WHERE t.ID = ~[x:userid] AND gp.cat = 'groups') LIKE '%' || lg.LogTypeID || '%'
        order by lg.entry_date DESC, lg.Entry_Time DESC
    ]
        {
            "gpvfields": ["curstudid", "teacherid"],
            "logDCID": "~(ldcid;js)",
            "studentDCID": "~(sdcid;js)",
            "name": "~(name;js)",
            "entryDate": "~(entry_date;js)",
            "hours": "~(Hours;js)",
            "minutes": "~(Minutes;js)",
            "ampm": "~(ampm;js)",
            "entryAuthor": "~(entry_author;js)",
            "subType": "~(subtype;js)",
            "subject": "~(subject;js)",
            "logText": "~(logText;js)"
        },
    [/tlist_sql]{}
]